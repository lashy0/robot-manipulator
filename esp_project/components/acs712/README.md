## Компонент для работы с датчиком тока ACS712

### Описание

Компонент предназначен для работы с датчиком тока ACS712 в esp-idf.
Включает в себя функции инициализации, чтения сырах значений, значения напряжения и расчет тока в амперах.
Поддерживает калибровку с помощью схем Curve Fitting и Line Fitting.

### Фильтрация данных с ACS712

Компонент включает функции для фильтрации сырых значений, напряжения и тока, чтобы минимизировать шум и повысить
стабильность результатов. Фильтрация осуществляется путем усреднения значений, полученных в ходе серии измерений
с небольшими задержками между ними.

### Структура данных датчика

Структура ```acs712_t``` содержит конфигурацию и параметры, необходимые для взаимодействия с датчиком ACS712:

```c
typedef struct {
    adc_oneshot_unit_handle_t adc_handle;   /**< Дескриптор для работы с ADC */
    adc_channel_t adc_channel;              /**< Канал ADC, используемый для датчика */
    adc_unit_t unit;                        /**< Единица ADC, используемая для работы */
    adc_atten_t atten;                      /**< Уровень ослабления ADC */
    adc_cali_handle_t cali_handle;          /**< Дескриптор калибровки ADC */
    bool calibrated;                        /**< Флаг, указывающий на успешную калибровку */
    float sensitivity;                      /**< Чувствительность датчика (мВ/А) */
    int calibrate_voltage;                  /**< Напряжение калибровки в мВ */
} acs712_t;
```

### API

#### Инициализация датчика ACS712

```c
esp_err_t acs712_init(acs712_t *acs712, adc_unit_t unit, adc_atten_t atten, adc_channel_t channel, float sensitivity)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```unit```: Единица ADC, используемая для работы.
- ```atten```: Уровень ослабления ADC.
- ```channel```: Канал ADC для подключения датчика.
- ```sensitivity```: Чувствительность датчика (мВ/А).

Возвращает:
- ```ESP_OK``` когда успешная инициализация.
- ```ESP_FAIL``` когда произошла ошибка инициализации.

#### Деинициализация датчика ACS712

```c
esp_err_t acs712_deinit(acs712_t *acs712)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.

Возвращает:
- ```ESP_OK``` в случае успешного деинициализации.
- ```ESP_ERR_INVALID_ARG``` если указатель acs712 равен NULL.
- ```ESP_FAIL``` когда произощла ошибка при деинициализации.

#### Калибровка нулевого значения ACS712

Эта функция используется для калибровки нулевого значения датчика, что особенно важно для получения корректных
показаний при отсутствии тока.

```c
esp_err_t acs712_calibrate_voltage(acs712_t *acs712, int samples)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```samples```: Количество выборок для усреднения.

Возвращает:
- ```ESP_OK``` в случае успешной калибровки.
- ```ESP_FAIL``` если произошла ошибка при чтении или преобразовании.

#### Рекалибровка ACS712

```c
esp_err_t asc712_recalibrate(acs712_t *acs712)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.

Возвращает:
- ```ESP_OK``` в случае успешного рекалибровки.
- ```ESP_ERR_INVALID_ARG``` если указатель acs712 равен NULL.
- ```ESP_FAIL``` когда произощла ошибка при рекалибровки.

#### Чтение сырых данных ADC с ACS712

```c
esp_err_t acs712_read_raw(acs712_t *acs712, int *data)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```data```: Указатель для сохранения прочитанного значения.

Возвращает:
- ```ESP_OK``` в случае успешного чтения.
- ```ESP_FAIL``` если чтение завершилось неудачей.

#### Чтение напряжения (мВ) с ACS712

```c
esp_err_t acs712_read_voltage(acs712_t *acs712, int *data)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```data```: Указатель для сохранения прочитанного значения.

Возвращает:
- ```ESP_OK``` в случае успешного чтения.
- ```ESP_FAIL``` если чтение завершилось неудачей.

#### Чтение тока (А) с ASC712

```c
esp_err_t acs712_read_current(acs712_t *acs712, float *data)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```data```: Указатель для сохранения прочитанного значения.

Возвращает:
- ```ESP_OK``` в случае успешного чтения.
- ```ESP_FAIL``` если чувствительность даьчика равно 0 или ошибка при чтении.

#### Чтение отфильтрованных сырых данных ADC с ACS712

```c
esp_err_t acs712_read_filtered_raw(acs712_t *acs712, int *data)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```data```: Указатель для сохранения отфильтрованного значения.

Возвращает:
- ```ESP_OK``` в случае успешного чтения.
- ```ESP_FAIL``` если чтение завершилось неудачей.

#### Чтение отфильтрованного напряжения (мВ) с ACS712

```c
esp_err_t acs712_read_filtered_voltage(acs712_t *acs712, int *data)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```data```: Указатель для сохранения отфильтрованного значения напряжения.

Возвращает:
- ```ESP_OK``` в случае успешного чтения.
- ```ESP_FAIL``` если чтение завершилось неудачей.

#### Чтение отфильтрованного тока (А) с ACS712


```c
esp_err_t acs712_read_filtered_current(acs712_t *acs712, float *data)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```data```: Указатель для сохранения отфильтрованного значения тока.

Возвращает:
- ```ESP_OK``` в случае успешного чтения.
- ```ESP_FAIL``` если произошла ошибка при чтении.

#### Калибровка отфильтрованного нулевого значения ACS712

Эта функция используется для калибровки отфильтрованного нулевого значения датчика, что особенно важно
для получения корректных показаний при отсутствии тока.

```c
esp_err_t acs712_calibrate_voltage(acs712_t *acs712, int samples)
```

Параметры:
- ```acs712```: Указатель на структуру данных датчика.
- ```samples```: Количество выборок для усреднения.

Возвращает:
- ```ESP_OK``` в случае успешной калибровки.
- ```ESP_FAIL``` если произошла ошибка при чтении или преобразовании.


### Пример использования


```c
#include "acs712.h"

void app_main(void)
{
    acs712_t acs712;
    esp_err_t ret;

    // Инициализация датчика
    ret = acs712_init(&acs712, ADC_UNIT_1, ADC_ATTEN_DB_12, ADC_CHANNEL_2, 185.0);
    if (ret == ESP_OK) {
        ESP_LOGI("APP", "Датчик успешно инициализирован");
    }

    // Калибровка нулевого значения
    ret = acs712_calibrate_voltage(&acs712, 50);
    if (ret == ESP_OK) {
        ESP_LOGI("APP", "Калибровка завершена успешно");
    }

    // Чтение тока
    float current;
    ret = acs712_read_current(&acs712, &current);
    if (ret == ESP_OK) {
        ESP_LOGI("APP", "Ток: %f A", current);
    }

    // Деинициализация датчика
    acs712_deinit(&acs712);
}
```
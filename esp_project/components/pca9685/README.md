## Компонент для работы с PCA9685

### Описание

PCA9685 - это 16 канальный ШИМ-контроллер, раьотающий через I2C интерфейс. Данный компонент позволяет
управлять PWM-каналами и устанавливать частоту ШИМ для каждого канала.

### Структура данных PCA9685

Структура ```pca9685_t``` содержит конфигурацию и параметры, необходимые для взаимодействия с PCA9685:

```c
typedef struct {
    i2c_master_dev_handle_t i2c_dev; /**< Хендл I2C устройства */
    uint32_t oscillator_freq;        /**< Частота тактового генератора */
    bool is_initialized;             /**< Флаг, указывающий инициализацию устройства */
} pca9685_t;
```

### Структура конфигурации для драйвера PCA9685

```c
typedef struct {
    uint8_t i2c_address;                    /**< I2C адрес устройства */
    i2c_master_bus_handle_t bus_handle;     /**< I2C хендл шины */
    uint32_t scl_speed;                     /**< I2C скорость тактового сигнала */
} pca9685_config_t;
```

### API

#### Инициализация устройства PCA9685

```c
esp_err_t pca9685_init(pca9685_config_t *config, pca9685_t *pca9685)
```

Параметры:
- ```config```: Указатель на структуру конфигурации.
- ```pca9685```: Указатель на структуру устройства PCA9685.

Возвращает:
- ```ESP_OK```: в случае успешной инициализации.
- ```ESP_ERR_INVALID_STATE```: если устройство уже инициализировано.
- ```ESP_FAIL```: когда произошла ошибка при инициализации.

#### Деинициализация устройства PCA9685

```c
esp_err_t pca9685_deinit(pca9685_t *pca9685)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.

Возвращает:
- ```ESP_OK```: в случае успешнаой деинициализации.
- ```ESP_ERR_INVALID_STATE```: если устройство не инициализировано.
- ```ESP_FAIL```: когда произошла ошибка при денициализации.

#### Запись байт данных в указанный регистр PCA9685

```c
esp_err_t pca9685_write(pca9685_t *pca9685, uint8_t reg, uint8_t data)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.
- ```reg```: Адрес регистра для записи.
- ```data```: Данные для записи.

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при записи.

#### Чтение байт данных с указанного регистра PCA9685

```c
esp_err_t pca9685_read(pca9685_t *pca9685, uint8_t reg, uint8_t *data)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.
- ```reg```: Адрес регистра для записи.
- ```data```: Указатель для сохранения прочитаных данных.

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при чтении.


#### Устанавливает ШИМ сигнал для указанного канала

```c
esp_err_t pca9685_set_pwm(pca9685_t *pca9685, uint8_t channel, uint16_t on_time, uint16_t off_time)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.
- ```channel```: Номер ШИМ канала (0-15).
- ```on_time```: Время включения ШИМ (0-4095).
- ```off_time```: Время выключения ШИМ (0-4095).

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при выполнении.

#### Чтение ШИМ сигнала для указанного канала

```c
esp_err_t pca9685_get_pwm(pca9685_t *pca9685, uint8_t channel, uint16_t *on_time, uint16_t *off_time)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.
- ```channel```: Номер ШИМ канала (0-15).
- ```on_time```: Указатель для сохранения времени включения ШИМ (0-4095).
- ```off_time```: Указатель для сохраненияв времени выключения ШИМ (0-4095).

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при выполнении.

#### Перезагрузка PCA9685

```c
esp_err_t pca9685_reset(pca9685_t *pca9685)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при выполнении.

#### Перевот PCA9685 в спящий режим

```c
esp_err_t pca9685_sleep(pca9685_t *pca9685)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при выполнении.

#### Вывод PCA9685 из спящего режима

```c
esp_err_t pca9685_wake(pca9685_t *pca9685)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при выполнении.

#### Установка частоты ШИМ для устройства PCA9685

```c
esp_err_t pca9685_set_pwm_freq(pca9685_t *pca9685, float freq)
```

Параметры:
- ```pca9685```: Указатель на структуру устройства PCA9685.
- ```freq```: Желаемая частота ШИМ в Гц

Возвращает:
- ```ESP_OK```: в случае успешного выполнения.
- ```ESP_FAIL```: когда произошла ошибка при установки частоты.

### Пример использования

```c
#include "pca9685.h"

void app_main(void)
{
    esp_err_t ret;
    pca9685_t pca9685;

    // Инициализация PCA9685
    pca9685_config_t config = {
        .bus_handle = <свой master bus handle>,
        .scl_speed = 100000,
        .i2c_address = 0x40
    };

    esp_err_t ret = pca9685_init(&config, &pca9685);
    if (ret != ESP_OK) {
        return;
    }

    uint8_t channel = 0;
    uint16_t on_time = 0;
    uint16_t off_time = 2048;

    ret = pca9685_set_pwm(&pca9685, channel, on_time, off_time);
    if (ret == ESP_OK) {
        ESP_LOGI("APP", "ШИМ сигнал установлен для канала %d", channel);
    }

    // Уcтановка частоты ШИМ
    ret = pca9685_set_pwm_freq(&pca9685, 50);
    if (ret == ESP_OK) {
        ESP_LOGI("APP", "Частота ШИМ успешно установлена");
    }

    // Деинициализация PCA9685
    pca9685_deinit(&pca9685);
}
```